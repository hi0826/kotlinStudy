# 제네릭

## 제네릭 기본 사용

- 컴파일 시간에 자료형을 검사해서 적당한 자료형을 선택할 수 있게 사용
- 앵글 브라켓 사이에 형식 매개변수를 사용
  - `<T>`
- 형식 매개변수의 이름
  - 대표적으로 사용하는 예시
  - E (element)
  - K (key)
  - N (number)
  - T (type)
  - V (value)
  - S, U, V etc
- 형식 매개변수를 한 개 이상 받는 클래스
  - 인스턴스를 생성하는 시점에서 클래스의 자료형을 정함
  - 제네릭 클래스 내에 메서드에서도 형식 매개변수를 사용
  - 프로퍼티에 지정하는 경우 생성자에 형식 매개변수 사용
- 형식 매개변수는 기본적으로 nullable
  - ?.를 사용해서 null check를 해주자
  - String(다른 타입도 해당), String? 은 다른 자료형이라고 생각하자
- null을 허용하고 싶지 않다면
  - `<T: Any>` 사용
  - Any?는 nullable

## 제네릭 메서드

- 함수나 메서드 앞에 `<T>`와 같이 지정
- 자료형의 결정은 함수가 호출될 때 컴파일러가 자료형 추론
- 반환, 매개변수 자료형에 사용 가능
- 여러 개인 경우 `<K, V>`식으로 사용 가능
- 형식 매개변수로 선언된 함수의 매개변수를 연산할 경우
  - 코드 상에서 형이 결정되지 않았기 떄문에 연산이 안됨
  - 람다식을 사용해서 연산식을 지정할 수 있다.

```kotlin
fun <T> add(a:T, b:T, op:(T, T) -> T): T {
    return op(a, b)
}
fun main() {
    val return = add(2, 3, {a, b -> a + b})
    // val return = add(2, 3) {a, b -> a + b}
}

```

- 형식 매개변수를 특정한 자료형으로 제한
- 자료형의 사용범위를 제한할 수 있음
  - `:`과 자료형을 기입하면 형식 매개변수의 자료형을 제한 할 수 있음
  - 자바에서는 extern, super 사용
  - 함수에서도 제한할 수 있음
    - `fun <T:Number> addLimit(a:T, b:T, op: (T, T) -> T)`
- 상,하위 형식의 가변성
  - A의 값이 필요한 모든 장소에 B의 값을 넣어도 아무 문제가 없으면 B는 A의 하위 형식
  - Int는 Number의 하위 클래스
- 거의 모든 자료형은 클래스임
  - ?가 붙은 Nullable 자료형은 예외
- 하위클래스는 상위클래스가 수용

## 가변성의 3가지 유형

- 공변성(covariance)
  - K가 T의 하위 자료형이라면 `C<K>`는 `C<T>`의 하위 자료형이다.
  - 생산자 입장의 out 성질
- 반공변성(contravariance)
  - K가 T의 하위 자료형이면, `C<K>`는 `C<T>`의 하위 자료형이다.
  - 소비자 입장의 in 성질
- 무변성(invariance)
  - 아무 관계가 없다
  - 생산자 + 소비자

### 무변성

- 자료형 사이의 하위 자료형 관계가 성립되지 않음
- 코틀린에서는 따로 지정해주지 않으면 기본적으로 무변성

### 공변성

- out 지정
- 형식 매개변수 사이의 하위 자료형 관계가 성립
- 하위 자료형 관계가 그대로 인스턴스 자료형 사이의 관계로 이어지는 경우
- out 키워드를 사용해 정의

### 반공변성

- in 지정
- 자료형의 상하 관계가 반대
- 하위 클래스의 자료형을 상위 클래스의 자료형이 허용

## 자료형 프로젝션

- 선언 지점 변성
  - 클래스 자체에 가변성을 지정하는 방식으로 in/out 지정 가느
  - 선언하면서 지정하면 클래스의 공변성을 전체적으로 지정
- 사용 지정 변성
  - 가변적으로 지정하고 싶을 경우
  - `class Box<T>(var item: T)`
  - 사용 시점에서 item을 얻느냐 설정하느냐 결정

```kotlin
fun <T> printObj(box: Box<out Animal>) {
    val obj: Animal = box.item
    println(obj)
}
```

- 자료형 프로젝션을 통해 자료의 안전성을 보장

### 스타 프로젝션

- in/out을 정하지 않고 추후에 결정
  - 어떤 자료형이라도 들어올 수 있으나 구체적으로 자료형이 결정되고 난 후 자료형과 하위 자료형의 요소만 담을 수 있도록 제한
- in 으로 정의되어있는 T를 \*로 받으면 in Nothing으로 간주
- out 으로 정의되어있는 T를 \*로 받으면 out Any?인 것으로 간주

### 정리

- out projection
  - 공변성
  - 형식 매개변수는 세터를 통해 값을 설정하는것이 제한
- in projection
  - 반 공변성
  - 형식 매개변수는 게터를 통해 값을 읽거나 반환 가능
- start projection
  - in/out은 사용방향에 따라 결정

### reified 자료형

- T를 직접 사용하고 싶은 경우
  - 매개변수화 해야한다
- reified로 형식 매개변수 T를 지정하면 **실행 시간**에 접근 가능
- inline 함수에서만 사용가능
  - 컴파일러가 복사해 넣을 때 실제 자료형을 알 수 있기 떄문
